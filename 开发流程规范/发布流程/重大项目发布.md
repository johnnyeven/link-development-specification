# 重大项目发布

重大项目发布一般指代对现有业务流程有破坏性变更，或有新业务接入并且对现有业务产生直接影响的发布事件。

重大项目发布在发布日前两周开始准备以下发布流程，前一周需进行发布流程评审，由Leader负责组织全组开发及测试人员共同审阅，评审完成后应输出《重大项目上线流程检查清单》。

## 代码

于发布日两周前进行代码封版，发布分支不再接受开发分支的合并请求，仅接受Bug分支合并请求。详情请参见《LINK项目组编码规范文档》中开发流程规范章节的[金融产品事业部项目开发流程](../分支管理/金融产品事业部项目开发流程.md)小节

### 分支命名

请参见《LINK项目组编码规范文档》中开发流程规范章节的[金融产品事业部项目开发流程](../分支管理/金融产品事业部项目开发流程.md)小节

### 版本号

请参见《LINK项目组编码规范文档》中开发流程规范章节的[金融产品事业部项目开发流程](../分支管理/金融产品事业部项目开发流程.md)小节

## 数据库迁移

数据库迁移所使用的SQL，应区分结构变更SQL与数据修复SQL文件

1. 结构变更SQL文件`structure.sql`

	> 应只包含针对数据库的结构变更的SQL
	> 表需要有完整的注释信息
	> 表中涉及的各字段必须包含完整注释信息
	> 表中索引需要包含注释信息，信息需要解释该索引服务的对象

2. 数据修复SQL文件`migration.sql`

	> 应只包含`INSERT`及`UPDATE`语句
	> 每条语句需包含注释信息，解释其作用
	
3. 数据修复脚本

	> 数据修复脚本仅适用于无法使用单纯SQL进行修复的场景
	> 所有数据修复脚本需经过代码评审

## 配置文件

配置文件新增或变更于代码封版时，由各组Leader整理提供，需要检查以下项目

> 所有配置文件语法检查
> 配置内容正确无误
> 若配置文件结构由变更，需核实结构变更的目的，以及对应的业务处理代码是否正确

## 服务器配置变更

主要涉及需要运维配合进行服务器的配置变更项，包括但不限于以下配置

> nginx服务器配置
> PHP配置
> supervisor配置
> memcached配置
> RDS配置
> 其他基础服务配置

## 发布完成后序流程

以上发布流程完成后，需对业务系统进行配置，配置内容可能根据不同业务系统有所变更，就目前代码架构的基础上，主要存在以下几点

### 接口授权

请按照以下示例格式整理需同步并授权的接口

| 接口名称 | 方法名 | 授权机构 |
| :--- | :--- | :--- |
| 接收微众审核白名单接口 | link.api.webankTryWhiteList | 汇通天下 |

### 资源同步

请按照以下示例格式整理需同步的资源

| 资源名称 |
| :--- |
| 审核白名单 - 保存按钮 |
| 审核白名单 - 导出按钮 |

### 任务调度配置

请按照以下示例格式整理任务调度配置

| 任务名称 | 调度周期 | 任务执行类 |
| :--- | :--- | :--- |
| 易路通达消费明细入库任务 | 0 5 * * * | Job\Chepass\Etxexpenses\MainJob  |

### 消息模板配置

消息模板配置由于没有入口，所以一般由数据迁移过程中提供SQL完成。

### 授信中心产品配置

授信中心由于不能线上添加产品，所以一般由数据迁移过程中提供SQL完成。

## 重大项目上线流程检查清单

清单内容需包括以上各点详细说明，且需提供诸如`环境配置文件``程序配置文件``SQL文件`等重要文件，清单中的目录组织如下所示

```
cat_link.checklist
	database/
		structure.sql
		migration.sql
		fixSomething.php
	framework_config/
		config.php
		my.php
		...
	system_config/
		supervisor/
			link.conf
			credit.conf
		nginx/
			link.g7s.huoyunren.com.conf
	checklist.md(or xlsx, docx and any others you wanted.)
```

其中checklist.md用以整理以上个点详细说明，其中各点需要设置直接负责人，由专人确认是否操作成功，`database/`目录中存放数据迁移脚本，`framework_config/`目录中存放程序配置文件，`system_config/`目录中按照基础服务为子目录整理各服务的配置文件。

输出此检查清单后，直到上线的一周内，需要由各组Leader维护，非特殊情况不再变更，如果需要变更，需重新评审，上线时将依照此检查清单，依次处理。


